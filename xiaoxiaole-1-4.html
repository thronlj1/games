<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‰∫å‰∏ãÁ¨îÈ°∫1-4Ê∂àÊ∂à‰πê</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #FEF9E7; /* Â•∂ÁôΩËâ≤ËÉåÊôØ */
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px 5px;
            position: relative;
            max-width: 100vw;
            overflow-x: hidden;
        }
        
        header {
            width: 95%;
            text-align: center;
            margin-bottom: 20px;
            padding: 15px 0;
            background: linear-gradient(to right, #80D8C3, #4DA8DA);
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: white;
            font-size: 3.2rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            letter-spacing: 3px;
        }
        
        .game-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 95%;
            max-width: 1200px;
            margin: 0 auto 10px;
            padding: 12px 15px;
            background-color: #e3e5de;
            border-radius: 12px;
            font-size: 1.2rem;
            font-weight: bold;
            color: #333;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .difficulty-selector {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .difficulty-btn {
            border: none;
            color: white;
            padding: 10px 25px;
            font-size: 1.2rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            opacity: 0.8;
            position: relative;
            overflow: hidden;
        }
        
        .difficulty-btn:hover {
            opacity: 1;
            transform: translateY(-2px);
        }
        
        .difficulty-btn.active {
            opacity: 1;
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .difficulty-btn.easy {
            background: linear-gradient(to right, #7bed9f, #2ed573);
        }
        
        .difficulty-btn.hard {
            background: linear-gradient(to right, #ff6b81, #ff4757);
        }
        
        .score-info {
            display: flex;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .mistakes {
            color: #ff6b6b;
        }
        
        .stars {
            color: #ffd700;
            font-size: 1.6rem;
            display: flex;
            gap: 3px;
            transition: all 0.3s ease;
        }

        .star {
            transition: all 0.3s ease;
        }

        .star.filled {
            color: #ffd700;
            text-shadow: 0 0 5px rgba(255, 215, 0, 0.5);
        }

        .star.empty {
            color: #ccc;
            text-shadow: none;
        }
        
        .mode-display {
            display: inline-block;
            color: white;
            padding: 4px 12px;
            border-radius: 6px;
            font-size: 1rem;
            margin-left: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .mode-display.easy {
            background: linear-gradient(45deg, #7bed9f, #2ed573);
        }
        
        .mode-display.hard {
            background: linear-gradient(45deg, #ff6b81, #ff4757);
        }
        
        .restart-game-btn {
            background: linear-gradient(to right, #80D8C3, #4DA8DA);
            border: none;
            color: white;
            padding: 8px 20px;
            font-size: 1.2rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }
        
        .restart-game-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        
        .game-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
            width: 95%;
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }
        
        .card {
            height: 90px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            cursor: pointer;
            text-align: center;
            padding: 8px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            user-select: none;
            aspect-ratio: 1;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.2);
        }
        
        .card.selected {
            transform: scale(1.05);
            box-shadow: 0 0 15px rgba(255,99,71,0.6);
            border: 3px solid #ff6b6b;
            animation: selectedPulse 1.5s infinite;
        }

        @keyframes selectedPulse {
            0% { border-color: #ff6b6b; }
            50% { border-color: #ff8787; }
            100% { border-color: #ff6b6b; }
        }
        
        /* ÂåπÈÖçÊàêÂäüÁöÑÂä®Áîª */
        @keyframes matchSuccess {
            0% { 
                transform: scale(1) translateY(0);
                background-color: #2ed573;
            }
            50% { 
                transform: scale(1.15) translateY(-8px);
                background-color: #7bed9f;
            }
            100% { 
                transform: scale(1) translateY(0);
                background-color: initial;
            }
        }

        .card.match-animation {
            animation: matchSuccess 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        
        .english {
            background-color: #80D8C3;
            color: white;
        }
        
        .chinese {
            background-color: #4DA8DA;
            color: white;
        }
        
        .matched {
            background-color: #e3e5de !important;
            color: #999 !important;
            cursor: default;
            transform: none !important;
            box-shadow: none !important;
            border: 2px solid #ccc !important;
            opacity: 0.8;
            transition: all 0.3s ease 0.3s;
        }
        
        .success-message {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.85);
            backdrop-filter: blur(8px);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            color: white;
            font-size: 2rem;
            text-align: center;
            display: none;
        }
        
        .success-message h2 {
            font-size: 3em;
            color: #FFD700;
            text-shadow: 0 0 20px rgba(255,215,0,0.6);
            margin-bottom: 30px;
            animation: titleGlow 2s infinite;
        }

        @keyframes titleGlow {
            0%, 100% { text-shadow: 0 0 20px rgba(255,215,0,0.6); }
            50% { text-shadow: 0 0 40px rgba(255,215,0,0.8); }
        }
        
        .result-card {
            background: linear-gradient(145deg, rgba(255,255,255,0.15), rgba(255,255,255,0.05));
            border-radius: 20px;
            padding: 30px 40px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .stars-container {
            font-size: 2.5em;
            margin: 20px 0;
            color: #FFD700;
            text-shadow: 0 0 10px rgba(255,215,0,0.4);
        }

        .star {
            display: inline-block;
            margin: 0 5px;
            animation: starPop 0.5s ease-out;
            animation-fill-mode: both;
        }

        @keyframes starPop {
            0% { transform: scale(0); opacity: 0; }
            50% { transform: scale(1.2); }
            100% { transform: scale(1); opacity: 1; }
        }

        .info-text {
            font-size: 1.2em;
            margin: 12px 0;
            color: rgba(255,255,255,0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .info-text strong {
            color: #80D8C3;
        }

        .history-text {
            color: #4DA8DA;
            font-size: 1em;
            margin-top: 15px;
        }

        .restart-btn {
            background: linear-gradient(45deg, #80D8C3, #4DA8DA);
            border: none;
            color: white;
            padding: 15px 40px;
            font-size: 1.4em;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            margin-top: 20px;
        }
        
        .restart-btn:hover {
            transform: scale(1.05) translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
        }
        
        @media (max-width: 768px) {
            .game-container {
                grid-template-columns: repeat(auto-fit, minmax(90px, 1fr));
                gap: 8px;
            }

            .card {
                height: 80px;
                font-size: 1.1rem;
                padding: 6px;
            }
        }
        
        @media (max-width: 480px) {
            .game-container {
                grid-template-columns: repeat(auto-fit, minmax(70px, 1fr));
                gap: 6px;
            }

            .card {
                height: 70px;
                font-size: 1rem;
                padding: 4px;
            }

            .game-info {
                flex-direction: column;
                align-items: stretch;
                text-align: center;
                gap: 8px;
            }

            .score-info {
                justify-content: center;
            }

            .timer-container {
                justify-content: center;
                flex-wrap: wrap;
            }
        }

        @keyframes rotate {
            0% {
                transform: rotate(0deg);
            }
            100% {
                transform: rotate(360deg);
            }
        }

        .hourglass {
            display: inline-block;
            font-size: 1.4rem;
            margin-right: 8px;
            animation: rotate 2s linear infinite;
        }

        .timer-container {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            margin-left: auto;
            gap: 10px;
        }

        .test-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0,0,0,0.5);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            z-index: 999;
        }

        /* Êñ∞Â¢ûÔºöË°®ÊÉÖÂä®ÁîªÊïàÊûú */
        @keyframes gentle-bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-3px); }
        }

        @keyframes slight-shake {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(5deg); }
            75% { transform: rotate(-5deg); }
        }

        @keyframes faster-shake {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(8deg); }
            75% { transform: rotate(-8deg); }
        }

        @keyframes rapid-shake {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(12deg); }
            75% { transform: rotate(-12deg); }
        }

        @keyframes intense-shake {
            0%, 100% { transform: rotate(0deg); }
            25% { transform: rotate(15deg); }
            75% { transform: rotate(-15deg); }
        }

        .time-emoji {
            display: inline-block;
            font-size: 1.4rem;
            margin-right: 8px;
        }

        .time-emoji.relaxed {
            animation: gentle-bounce 2s infinite;
        }

        .time-emoji.concerned {
            animation: slight-shake 2s infinite;
        }

        .time-emoji.worried {
            animation: faster-shake 1.5s infinite;
        }

        .time-emoji.nervous {
            animation: rapid-shake 1.2s infinite;
        }

        .time-emoji.panic {
            animation: intense-shake 0.8s infinite;
        }

        /* Êñ∞Â¢ûÔºöÊó∂Èó¥ÊèêÈÜíÊ†∑Âºè */
        .reminder-toast {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 24px;
            border-radius: 8px;
            background: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            display: flex;
            align-items: center;
            gap: 8px;
            animation: slide-in 0.5s ease-out;
            font-size: 1.1rem;
        }

        .reminder-toast.info {
            border-left: 4px solid #4DA8DA;
        }

        .reminder-toast.warning {
            border-left: 4px solid #ffa502;
        }

        .reminder-toast.urgent {
            border-left: 4px solid #ff6b81;
        }

        .reminder-toast.critical {
            border-left: 4px solid #ff4757;
            animation: slide-in 0.5s ease-out, shake 0.5s ease-in-out 0.5s;
        }

        @keyframes slide-in {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slide-out {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* ÂºÄÂßãÁïåÈù¢Ê†∑Âºè */
        .start-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #80D8C3, #4DA8DA);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        .start-title {
            font-size: 4rem;
            color: white;
            text-shadow: 0 4px 12px rgba(0,0,0,0.2);
            margin-bottom: 40px;
            text-align: center;
            animation: titleFloat 3s ease-in-out infinite;
        }

        @keyframes titleFloat {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .start-difficulty {
            display: flex;
            gap: 20px;
            margin-bottom: 40px;
        }

        .difficulty-option {
            border: none;
            color: white;
            padding: 12px 30px;
            font-size: 1.4rem;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            margin: 0 10px;
            opacity: 0.85;
            position: relative;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .difficulty-option:hover {
            opacity: 1;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.2);
        }

        .difficulty-option.selected {
            opacity: 1;
            transform: scale(1.1);
            box-shadow: 0 8px 16px rgba(0,0,0,0.3);
        }

        .difficulty-option.selected::after {
            content: '';
            position: absolute;
            top: -8px;
            left: -8px;
            right: -8px;
            bottom: -8px;
            border-radius: 14px;
            border: 3px solid rgba(255,255,255,0.6);
            animation: pulseSelect 1.5s infinite;
        }

        @keyframes pulseSelect {
            0% {
                transform: scale(1);
                opacity: 0.6;
            }
            50% {
                transform: scale(1.05);
                opacity: 0.3;
            }
            100% {
                transform: scale(1);
                opacity: 0.6;
            }
        }

        .difficulty-option:first-child {
            background: linear-gradient(to right, #7bed9f, #2ed573);
        }

        .difficulty-option:last-child {
            background: linear-gradient(to right, #ff6b81, #ff4757);
        }

        .difficulty-option.selected:first-child {
            background: linear-gradient(to right, #2ed573, #7bed9f);
        }

        .difficulty-option.selected:last-child {
            background: linear-gradient(to right, #ff4757, #ff6b81);
        }

        .start-btn {
            font-size: 1.8rem;
            padding: 15px 60px;
            border: none;
            border-radius: 50px;
            background: white;
            color: #4DA8DA;
            cursor: pointer;
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
            transition: all 0.3s;
            margin-top: 20px;
        }

        .start-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 30px rgba(0,0,0,0.3);
        }

        .start-btn:active {
            transform: translateY(-1px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        /* ËøõÂ∫¶Êù°Ê†∑Âºè */
        .progress-container {
            width: 95%;
            max-width: 1200px;
            margin: 0 auto 15px;
            padding: 0 15px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(227, 229, 222, 0.5);
            border-radius: 4px;
            overflow: hidden;
            position: relative;
        }

        .progress-fill {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            background: linear-gradient(to right, #80D8C3, #4DA8DA);
            border-radius: 4px;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            width: 0%;
        }

        .progress-text {
            text-align: right;
            color: #666;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        /* ÂåπÈÖçÈîôËØØÁöÑÂä®Áîª */
        @keyframes matchError {
            0% { 
                transform: translateX(0);
                background-color: #ff6b6b;
            }
            25% { 
                transform: translateX(-8px);
            }
            75% { 
                transform: translateX(8px);
            }
            100% { 
                transform: translateX(0);
                background-color: initial;
            }
        }

        .card.error-animation {
            animation: matchError 0.4s ease-in-out;
        }

        /* ÂÆåÊàêÁâπÊïàÊ†∑Âºè */
        .firework {
            position: absolute;
            width: 6px;
            height: 6px;
            border-radius: 50%;
            pointer-events: none;
            animation: explode 1s ease-out forwards;
            z-index: 9999;
        }

        @keyframes explode {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            100% {
                transform: scale(30);
                opacity: 0;
            }
        }

        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            pointer-events: none;
            animation: shoot 0.6s ease-out forwards;
            z-index: 9999;
        }

        @keyframes shoot {
            0% {
                transform: translateY(0) translateX(0);
                opacity: 1;
            }
            100% {
                transform: translateY(var(--y)) translateX(var(--x));
                opacity: 0;
            }
        }

        .success-message {
            animation: messagePopIn 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);
            z-index: 9998;
        }

        @keyframes messagePopIn {
            0% { 
                transform: scale(0.5);
                opacity: 0;
            }
            100% { 
                transform: scale(1);
                opacity: 1;
            }
        }

        .result-card {
            animation: cardSlideIn 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
        }

        @keyframes cardSlideIn {
            0% {
                transform: translateY(50px);
                opacity: 0;
            }
            100% {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .success-title {
            animation: titleGlow 2s infinite;
            color: #FFD700;
            text-shadow: 0 0 20px rgba(255,215,0,0.6);
        }

        @keyframes titleGlow {
            0%, 100% { text-shadow: 0 0 20px rgba(255,215,0,0.6); }
            50% { text-shadow: 0 0 40px rgba(255,215,0,0.8); }
        }
    </style>
</head>
<body>
    <header>
        <h1>‰∫å‰∏ãÁ¨îÈ°∫1-4Ê∂àÊ∂à‰πê</h1>
    </header>
    
    <!-- Ê∑ªÂä†ÂºÄÂßãÁïåÈù¢ -->
    <div class="start-screen" id="startScreen">
        <h1 class="start-title">ÂçïËØçÊ∂àÊ∂à‰πê</h1>
        <div class="start-difficulty">
            <button class="difficulty-option selected" onclick="selectDifficulty('easy')">ÁÆÄÂçïÊ®°Âºè</button>
            <button class="difficulty-option" onclick="selectDifficulty('hard')">Âõ∞ÈöæÊ®°Âºè</button>
        </div>
        <button class="start-btn" onclick="startGame()">ÂºÄÂßãÊ∏∏Êàè</button>
    </div>

    <div class="game-info">
        <div class="score-info">
            <div>ÂåπÈÖçÂØπÊï∞: <span id="pairs">0</span> / <span id="totalPairs">0</span></div>
            <div class="mistakes">Â§±ËØØ: <span id="mistakes">0</span></div>
            <div class="stars">
                <span class="star filled">‚òÖ</span>
                <span class="star filled">‚òÖ</span>
                <span class="star filled">‚òÖ</span>
                <span class="star filled">‚òÖ</span>
                <span class="star filled">‚òÖ</span>
            </div>
            <div class="mode-display">
                ${currentDifficulty === 'easy' ? 'ÁÆÄÂçïÊ®°Âºè' : 'Âõ∞ÈöæÊ®°Âºè'}
            </div>
        </div>
        <div class="timer-container">
            <span>Áî®Êó∂: <span id="timer">0:00</span></span>
            <button class="restart-game-btn" onclick="restartGame()">
                <span style="font-size: 1.2em;">üîÑ</span>
                ÈáçÊñ∞ÂºÄÂßã
            </button>
        </div>
    </div>

    <!-- Ê∑ªÂä†ËøõÂ∫¶Êù° -->
    <div class="progress-container">
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="progress-text">ÂÆåÊàêÂ∫¶: <span id="progressText">0%</span></div>
    </div>

    <div class="game-container" id="gameContainer"></div>
    
    <!-- <button class="test-btn" onclick="testComplete()">ÊµãËØïÂÆåÊàêÂºπÁ™ó</button> -->

    <div class="success-message" id="successMessage">
        <h2 class="success-title">ÊÅ≠ÂñúÂÆåÊàêÔºÅ</h2>
        <div class="result-card">
            <div class="stars-container">
                ${getStarsHTML(stars)}
            </div>
            <div class="info-text">ÂÆåÊàêÁî®Êó∂: <strong>${formatTimeDetailed(elapsed)}</strong></div>
            <div class="info-text">Â§±ËØØÊ¨°Êï∞: <strong>${mistakeCount}Ê¨°</strong></div>
            <div class="info-text">ÈöæÂ∫¶Á∫ßÂà´: <strong>${currentDifficulty === 'easy' ? 'ÁÆÄÂçï' : 'Âõ∞Èöæ'}</strong></div>
            <div class="history-text">ÂéÜÂè≤ÊúÄ‰Ω≥: ${formatTimeDetailed(bestScore[currentDifficulty])}</div>
        </div>
        <button class="restart-btn" onclick="restartGame()">ÂÜçÊù•‰∏ÄÊ¨°</button>
    </div>

    <!-- Ë∞ÉËØïÊåâÈíÆ -->
    <!-- <button class="test-btn" onclick="debugGame()">Ë∞ÉËØïÁªìÊûú</button> -->

    <script>
        // ÂçïËØçÊï∞ÊçÆ
        const wordPairs = [
            { english: "Á´ñ", chinese: "Á´•10" },
            { english: "Ê®™ÊäòÈí©", chinese: "Êü≥8" },
            { english: "Á´ñÂºØÈí©", chinese: "Ê°É8" },
            { english: "Ê®™Êäò", chinese: "Áªø4" },
            { english: "ÁÇπ", chinese: "ÈÇì2" },
            { english: "Ê®™", chinese: "Âºï2" },
            { english: "Á´ñ", chinese: "Áîò3" },
            { english: "Á´ñÊäò", chinese: "Âåπ4" },
            { english: "ÁÇπ", chinese: "Â∑û5" },
            { english: "Ê®™ÊäòÈí©", chinese: "Â≤õ2" },
            { english: "ÁÇπ", chinese: "Ëàü4" },
            { english: "Êíá", chinese: "ÁÉ§2" },
            { english: "ÁÇπ", chinese: "ÁÅµ4" },
            { english: "Á´ñÊäò", chinese: "ÊØç1" },
            { english: "Ê®™ÊäòÂºØ", chinese: "Ëà¨8" },
            { english: "Êíá", chinese: "Ê≠ª5" }
        ];

        let cards = [];
        let selectedCards = [];
        let matchedPairs = 0;
        let startTime = null;
        let timerInterval = null;
        let currentDifficulty = 'easy';
        let mistakeCount = 0;
        let bestScore = localStorage.getItem('bestScore') ? JSON.parse(localStorage.getItem('bestScore')) : {};
        let visibleChineseCards = new Set(); // Â≠òÂÇ®Â∑≤ÊòæÁ§∫ÁöÑ‰∏≠ÊñáÂç°ÁâáÁ¥¢Âºï

        // Êñ∞Â¢ûÔºöÊó∂Èó¥Ë°®ÊÉÖÂíåÊèêÈÜíÈÖçÁΩÆ
        const timeEmojis = {
            relaxed: { emoji: "üòä", class: "relaxed" },      // 0-30Áßí
            concerned: { emoji: "üòÖ", class: "concerned" },   // 30-60Áßí
            worried: { emoji: "üò∞", class: "worried" },      // 1-2ÂàÜÈíü
            nervous: { emoji: "üò®", class: "nervous" },      // 2-3ÂàÜÈíü
            panic: { emoji: "üò±", class: "panic" }           // 3ÂàÜÈíü‰ª•‰∏ä
        };

        const timeReminders = [
            { time: 30, message: "Â∑≤ÁªèËøáÂéª30ÁßíÂï¶ÔºåÁªßÁª≠Âä†Ê≤πÔºÅ", style: "info", emoji: "üí™" },
            { time: 60, message: "1ÂàÜÈíü‰∫ÜÔºåË¶ÅÂä†Âø´ÈÄüÂ∫¶Âì¶ÔºÅ", style: "warning", emoji: "‚ö°" },
            { time: 120, message: "2ÂàÜÈíüËøáÂéª‰∫ÜÔºåÊäìÁ¥ßÊó∂Èó¥ÔºÅ", style: "urgent", emoji: "‚è∞" },
            { time: 180, message: "3ÂàÜÈíü‰∫ÜÔºåÂø´Âø´Âø´ÔºÅ", style: "critical", emoji: "üî•" }
        ];

        let lastReminderIndex = -1;
        let activeToast = null;

        // Êñ∞Â¢ûÔºöÂºÄÂßãÁïåÈù¢Áõ∏ÂÖ≥‰ª£Á†Å
        let selectedDifficulty = 'easy';
        
        function selectDifficulty(difficulty) {
            selectedDifficulty = difficulty;
            document.querySelectorAll('.difficulty-option').forEach(btn => {
                btn.classList.remove('selected');
                if (btn.textContent.includes(difficulty === 'easy' ? 'ÁÆÄÂçï' : 'Âõ∞Èöæ')) {
                    btn.classList.add('selected');
                }
            });
        }
        
        function startGame() {
            const startScreen = document.getElementById('startScreen');
            startScreen.style.animation = 'fadeOut 0.5s ease-out forwards';
            
            // ËÆæÁΩÆÈöæÂ∫¶Âπ∂ÂºÄÂßãÊ∏∏Êàè
            setDifficulty(selectedDifficulty);
            
            // ÁßªÈô§ÂºÄÂßãÁïåÈù¢
            setTimeout(() => {
                startScreen.style.display = 'none';
            }, 500);
        }

        // Ê∑ªÂä†Ê∑°Âá∫Âä®Áîª
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeOut {
                from { opacity: 1; }
                to { opacity: 0; }
            }
        `;
        document.head.appendChild(style);

        function getRandomHiddenChineseCard() {
            const hiddenChineseCards = cards
                .map((card, index) => ({ card, index }))
                .filter(({ card, index }) => 
                    card.type === 'chinese' && 
                    !card.matched && 
                    !visibleChineseCards.has(index)
                );
            
            if (hiddenChineseCards.length === 0) return null;
            
            const randomCard = hiddenChineseCards[Math.floor(Math.random() * hiddenChineseCards.length)];
            return randomCard.index;
        }

        function revealInitialCards() {
            if (currentDifficulty === 'hard') {
                visibleChineseCards.clear();
                // ÂàùÂßãÊòæÁ§∫3‰∏™‰∏≠ÊñáÂç°Áâá
                for (let i = 0; i < 3; i++) {
                    const cardIndex = getRandomHiddenChineseCard();
                    if (cardIndex !== null) {
                        visibleChineseCards.add(cardIndex);
                    }
                }
                // Êõ¥Êñ∞Âç°ÁâáÊòæÁ§∫
                updateCardsDisplay();
            }
        }

        function updateCardsDisplay() {
            cards.forEach((card, index) => {
                const cardElement = document.querySelector(`[data-index="${index}"]`);
                if (cardElement) {
                    cardElement.textContent = getCardText(card, index);
                }
            });
        }

        function setDifficulty(difficulty) {
            currentDifficulty = difficulty;
            initGame();
        }

        function getCardText(card, index) {
            if(card.type === 'english' || currentDifficulty === 'easy' || card.matched) {
                return card.text;
            } else if(currentDifficulty === 'hard' && card.type === 'chinese') {
                return visibleChineseCards.has(index) ? card.text : '???';
            }
            return card.text;
        }

        function calculateScore() {
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            const baseScore = currentDifficulty === 'easy' ? 30 : 50;
            let timeDeduction = 0;
            let mistakeDeduction = 0;
            
            // ËÆ°ÁÆóÊó∂Èó¥Êâ£ÂàÜ
            const timeLimit = {
                easy: { perfect: 120, good: 240 },    // 2ÂàÜÈíü, 4ÂàÜÈíü
                hard: { perfect: 240, good: 360 }     // 4ÂàÜÈíü, 6ÂàÜÈíü
            };
            
            const limit = timeLimit[currentDifficulty];
            if (elapsed > limit.perfect) {
                if (elapsed <= limit.good) {
                    // ÊØè30ÁßíÊâ£1ÂàÜ
                    timeDeduction = Math.floor((elapsed - limit.perfect) / 30);
                } else {
                    // Ë∂ÖËøágoodÊó∂Èó¥ÔºåÂÖàËÆ°ÁÆógood‰πãÂâçÁöÑÊâ£ÂàÜ
                    timeDeduction = Math.floor((limit.good - limit.perfect) / 30);
                    // ÂÜçËÆ°ÁÆóË∂ÖËøágoodÂêéÁöÑÊâ£ÂàÜÔºàÊØè30ÁßíÊâ£2ÂàÜÔºâ
                    timeDeduction += Math.floor((elapsed - limit.good) / 30) * 2;
                }
            }
            
            // ËÆ°ÁÆóÈîôËØØÊâ£ÂàÜ
            const mistakeMultiplier = currentDifficulty === 'easy' ? 2 : 1;
            mistakeDeduction = Math.min(
                mistakeCount * mistakeMultiplier,
                currentDifficulty === 'easy' ? 18 : 30
            );
            
            const finalScore = Math.max(
                baseScore - timeDeduction - mistakeDeduction,
                currentDifficulty === 'easy' ? 12 : 20
            );
            
            // Á°ÆÂÆöÊòüÁ∫ß
            let stars;
            const scorePercentage = (finalScore / baseScore) * 100;
            if (scorePercentage >= 80) {
                stars = '‚òÖ‚òÖ‚òÖ';
            } else if (scorePercentage >= 60) {
                stars = '‚òÖ‚òÖ';
            } else {
                stars = '‚òÖ';
            }
            
            return {
                baseScore,
                timeDeduction,
                mistakeDeduction,
                finalScore,
                stars
            };
        }

        function updateStars() {
            if (!startTime) return;
            
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            const stars = calculateStars(elapsed, mistakeCount);
            const starElements = document.querySelectorAll('.stars .star');
            
            starElements.forEach((star, index) => {
                if (index < stars) {
                    star.className = 'star filled';
                } else {
                    star.className = 'star empty';
                }
            });
        }

        function updateProgress() {
            const progress = (matchedPairs / wordPairs.length) * 100;
            const progressFill = document.getElementById('progressFill');
            const progressText = document.getElementById('progressText');
            
            progressFill.style.width = `${progress}%`;
            progressText.textContent = `${Math.round(progress)}%`;
        }

        function initGame() {
            // ÈáçÁΩÆÊ∏∏ÊàèÁä∂ÊÄÅ
            cards = [];
            selectedCards = [];
            matchedPairs = 0;
            mistakeCount = 0;
            document.getElementById('mistakes').textContent = '0';
            document.getElementById('pairs').textContent = '0';
            document.getElementById('totalPairs').textContent = wordPairs.length;
            
            // ÈáçÁΩÆËÆ°Êó∂Âô®
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            startTime = null;
            document.getElementById('timer').textContent = '0:00';
            
            // Êõ¥Êñ∞Ê®°ÂºèÊòæÁ§∫
            const modeDisplay = document.querySelector('.mode-display');
            if (modeDisplay) {
                modeDisplay.textContent = currentDifficulty === 'easy' ? 'ÁÆÄÂçïÊ®°Âºè' : 'Âõ∞ÈöæÊ®°Âºè';
                modeDisplay.className = 'mode-display ' + currentDifficulty;
            }
            
            // ÈáçÁΩÆÊòüÁ∫ß
            document.querySelectorAll('.stars .star').forEach(star => {
                star.className = 'star filled';
            });

            // ÈöêËóèÊàêÂäüÊ∂àÊÅØ
            const successMessage = document.getElementById('successMessage');
            if (successMessage) {
                successMessage.style.display = 'none';
            }

            // ÂàùÂßãÂåñÂç°Áâá
            initializeCards();
            
            // Ê∏ÖÈô§ÊâÄÊúâËÆ°Êó∂Âô®ÊèêÈÜí
            lastReminderIndex = -1;
            if (activeToast) {
                activeToast.remove();
                activeToast = null;
            }
            
            // ÈáçÁΩÆË°®ÊÉÖ
            const timerContainer = document.querySelector('.timer-container');
            const emojiSpan = timerContainer.querySelector('.time-emoji');
            if (emojiSpan) {
                emojiSpan.remove();
            }
        }

        function selectCard(index) {
            if (!startTime) {
                startTime = Date.now();
                startTimer();
            }
            
            const cardElement = document.querySelector(`[data-index="${index}"]`);
            
            // Ê£ÄÊü•ÊòØÂê¶ÂèØ‰ª•ÈÄâÊã©ËøôÂº†Âç°Áâá
            if (
                selectedCards.length === 2 || // Â∑≤ÁªèÈÄâÊã©‰∫Ü‰∏§Âº†Âç°Áâá
                selectedCards.includes(index) || // Â∑≤ÁªèÈÄâÊã©‰∫ÜËøôÂº†Âç°Áâá
                cards[index].matched // ËøôÂº†Âç°ÁâáÂ∑≤ÁªèÂåπÈÖç
            ) {
                return;
            }
            
            // ÈÄâÊã©Âç°Áâá
            cardElement.classList.add('selected');
            selectedCards.push(index);
            
            // Â¶ÇÊûúÈÄâÊã©‰∫Ü‰∏§Âº†Âç°ÁâáÔºåÊ£ÄÊü•ÊòØÂê¶ÂåπÈÖç
            if (selectedCards.length === 2) {
                setTimeout(checkMatch, 500);
            }
        }

        function checkMatch() {
            const [index1, index2] = selectedCards;
            const card1 = cards[index1];
            const card2 = cards[index2];
            
            const cardElement1 = document.querySelector(`[data-index="${index1}"]`);
            const cardElement2 = document.querySelector(`[data-index="${index2}"]`);
            
            const isMatch = (
                (card1.type === 'english' && card2.type === 'chinese') ||
                (card1.type === 'chinese' && card2.type === 'english')
            ) && (
                wordPairs.some(pair => 
                    (card1.text === pair.english && card2.text === pair.chinese) ||
                    (card1.text === pair.chinese && card2.text === pair.english)
                )
            );
            
            if (isMatch) {
                // ÁßªÈô§ÈÄâ‰∏≠Áä∂ÊÄÅ
                cardElement1.classList.remove('selected');
                cardElement2.classList.remove('selected');
                
                // Ê∑ªÂä†ÂåπÈÖçÊàêÂäüÂä®Áîª
                cardElement1.classList.add('match-animation');
                cardElement2.classList.add('match-animation');
                
                // Âä®ÁîªÁªìÊùüÂêéÊ∑ªÂä†ÂåπÈÖçÁä∂ÊÄÅ
                setTimeout(() => {
                    cardElement1.classList.remove('match-animation');
                    cardElement2.classList.remove('match-animation');
                    cardElement1.classList.add('matched');
                    cardElement2.classList.add('matched');
                    card1.matched = true;
                    card2.matched = true;
                }, 300);
                
                matchedPairs++;
                document.getElementById('pairs').textContent = matchedPairs;
                
                // Êõ¥Êñ∞ËøõÂ∫¶Êù°
                updateProgress();
                
                // Âú®Âõ∞ÈöæÊ®°Âºè‰∏ãÔºåÂåπÈÖçÊàêÂäüÂêéÈöèÊú∫ÊòæÁ§∫‰∏Ä‰∏™Êñ∞ÁöÑ‰∏≠ÊñáÂç°Áâá
                if (currentDifficulty === 'hard') {
                    const newCardIndex = getRandomHiddenChineseCard();
                    if (newCardIndex !== null) {
                        visibleChineseCards.add(newCardIndex);
                        updateCardsDisplay();
                    }
                }
                
                if (matchedPairs === wordPairs.length) {
                    gameComplete();
                }
            } else {
                // Ê∑ªÂä†ÈîôËØØÂä®Áîª
                cardElement1.classList.add('error-animation');
                cardElement2.classList.add('error-animation');
                
                // Âä®ÁîªÁªìÊùüÂêéÁßªÈô§Á±ªÂêç
                setTimeout(() => {
                    cardElement1.classList.remove('selected', 'error-animation');
                    cardElement2.classList.remove('selected', 'error-animation');
                }, 400);
                
                mistakeCount++;
                document.getElementById('mistakes').textContent = mistakeCount;
                updateStars();
            }
            
            selectedCards = [];
        }

        function startTimer() {
            timerInterval = setInterval(() => {
                const elapsed = Math.floor((Date.now() - startTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                
                // Êõ¥Êñ∞Êó∂Èó¥ÊòæÁ§∫
                const timeEmoji = getTimeEmoji(elapsed);
                const timerContainer = document.querySelector('.timer-container');
                const emojiSpan = timerContainer.querySelector('.time-emoji') || document.createElement('span');
                emojiSpan.className = `time-emoji ${timeEmoji.class}`;
                emojiSpan.textContent = timeEmoji.emoji;
                
                if (!timerContainer.contains(emojiSpan)) {
                    timerContainer.insertBefore(emojiSpan, timerContainer.firstChild);
                }
                
                document.getElementById('timer').textContent = 
                    `${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                // Ê£ÄÊü•ÊòØÂê¶ÈúÄË¶ÅÊòæÁ§∫ÊèêÈÜí
                for (let i = lastReminderIndex + 1; i < timeReminders.length; i++) {
                    if (elapsed >= timeReminders[i].time) {
                        showReminder(
                            timeReminders[i].message,
                            timeReminders[i].style,
                            timeReminders[i].emoji
                        );
                        lastReminderIndex = i;
                    }
                }
                
                updateStars();
            }, 1000);
        }

        function calculateStars(elapsed, mistakes) {
            if (elapsed <= 60 && mistakes <= 1) return 5;
            if (elapsed <= 120 && mistakes <= 3) return 4;
            if (elapsed <= 180 && mistakes <= 5) return 3;
            if (elapsed <= 240 && mistakes <= 7) return 2;
            return 1;
        }

        function getStarsHTML(count) {
            return Array(5).fill('‚òÜ').map((star, index) => 
                `<span class="star" style="animation-delay: ${index * 0.1}s">
                    ${index < count ? '‚òÖ' : '‚òÜ'}
                </span>`
            ).join('');
        }

        function createFirework(x, y) {
            const colors = ['#ff0', '#f0f', '#0ff', '#0f0', '#ff4757', '#2ed573'];
            const firework = document.createElement('div');
            firework.className = 'firework';
            firework.style.left = x + 'px';
            firework.style.top = y + 'px';
            firework.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
            document.body.appendChild(firework);

            // ÂàõÂª∫Á≤íÂ≠ê
            for (let i = 0; i < 30; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = x + 'px';
                particle.style.top = y + 'px';
                particle.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                
                const angle = (i * 12) * Math.PI / 180;
                const velocity = 50 + Math.random() * 50;
                particle.style.setProperty('--x', Math.cos(angle) * velocity + 'px');
                particle.style.setProperty('--y', Math.sin(angle) * velocity + 'px');
                
                document.body.appendChild(particle);
                
                // Ê∏ÖÁêÜÁ≤íÂ≠ê
                setTimeout(() => particle.remove(), 600);
            }
            
            // Ê∏ÖÁêÜÁÉüËä±
            setTimeout(() => firework.remove(), 1000);
        }

        function gameComplete() {
            clearInterval(timerInterval);
            const elapsed = Math.floor((Date.now() - startTime) / 1000);
            const stars = calculateStars(elapsed, mistakeCount);
            
            // ‰øùÂ≠òÊúÄ‰Ω≥ÊàêÁª©
            if(!bestScore[currentDifficulty] || elapsed < bestScore[currentDifficulty]) {
                bestScore[currentDifficulty] = elapsed;
                localStorage.setItem('bestScore', JSON.stringify(bestScore));
            }

            const successMessage = document.getElementById('successMessage');
            successMessage.innerHTML = `
                <h2 class="success-title">ÊÅ≠ÂñúÂÆåÊàêÔºÅ</h2>
                <div class="result-card">
                    <div class="stars-container">
                        ${getStarsHTML(stars)}
                    </div>
                    <div class="info-text">ÂÆåÊàêÁî®Êó∂: <strong>${formatTimeDetailed(elapsed)}</strong></div>
                    <div class="info-text">Â§±ËØØÊ¨°Êï∞: <strong>${mistakeCount}Ê¨°</strong></div>
                    <div class="info-text">ÈöæÂ∫¶Á∫ßÂà´: <strong>${currentDifficulty === 'easy' ? 'ÁÆÄÂçï' : 'Âõ∞Èöæ'}</strong></div>
                    <div class="history-text">ÂéÜÂè≤ÊúÄ‰Ω≥: ${formatTimeDetailed(bestScore[currentDifficulty])}</div>
                </div>
                <button class="restart-btn" onclick="restartGame()">ÂÜçÊù•‰∏ÄÊ¨°</button>
            `;
            successMessage.style.display = 'flex';

            // Ê∑ªÂä†ÂÆåÊàêÁâπÊïà
            let fireworkCount = 0;
            const maxFireworks = 8;
            const fireworkInterval = setInterval(() => {
                if (fireworkCount >= maxFireworks) {
                    clearInterval(fireworkInterval);
                    return;
                }
                const x = Math.random() * window.innerWidth;
                const y = Math.random() * (window.innerHeight * 0.7); // ÊéßÂà∂ÁÉüËä±È´òÂ∫¶
                createFirework(x, y);
                fireworkCount++;
            }, 200);
        }

        function formatTime(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${minutes}:${remainingSeconds.toString().padStart(2, '0')}`;
        }

        function formatTimeDetailed(seconds) {
            const minutes = Math.floor(seconds / 60);
            const remainingSeconds = seconds % 60;
            return `${minutes}ÂàÜ${remainingSeconds}Áßí`;
        }

        function restartGame() {
            // ÊòæÁ§∫ÂºÄÂßãÁïåÈù¢
            const startScreen = document.getElementById('startScreen');
            startScreen.style.display = 'flex';
            startScreen.style.opacity = '1';
            startScreen.style.animation = '';
            
            // ÈáçÁΩÆÊ∏∏ÊàèÁä∂ÊÄÅ
            initGame();
        }

        function testComplete() {
            startTime = Date.now() - 65000; // ËÆæÁΩÆÁî®Êó∂65Áßí
            mistakeCount = 2; // ËÆæÁΩÆ2Ê¨°Â§±ËØØ
            gameComplete();
        }

        function showReminder(message, style, emoji) {
            // Â¶ÇÊûúÊúâÊ¥ªÂä®ÁöÑÊèêÈÜíÔºåÂÖàÁßªÈô§ÂÆÉ
            if (activeToast) {
                activeToast.style.animation = 'slide-out 0.5s ease-out';
                setTimeout(() => {
                    activeToast.remove();
                }, 500);
            }

            // ÂàõÂª∫Êñ∞ÁöÑÊèêÈÜí
            const toast = document.createElement('div');
            toast.className = `reminder-toast ${style}`;
            toast.innerHTML = `<span style="font-size: 1.4rem">${emoji}</span> ${message}`;
            document.body.appendChild(toast);

            // 3ÁßíÂêéËá™Âä®Ê∂àÂ§±
            activeToast = toast;
            setTimeout(() => {
                toast.style.animation = 'slide-out 0.5s ease-out';
                setTimeout(() => {
                    toast.remove();
                    if (activeToast === toast) {
                        activeToast = null;
                    }
                }, 500);
            }, 3000);
        }

        function getTimeEmoji(elapsed) {
            if (elapsed < 30) {
                return timeEmojis.relaxed;
            } else if (elapsed < 60) {
                return timeEmojis.concerned;
            } else if (elapsed < 90) {
                return timeEmojis.worried;
            } else if (elapsed < 120) {
                return timeEmojis.nervous;
            }
            return timeEmojis.panic;
        }

        function debugGame() {
            // Ê£ÄÊü•Âπ∂ÊòæÁ§∫ÂΩìÂâçÁöÑÊúÄ‰Ω≥ÊàêÁª©
            console.log('ÂΩìÂâçlocalStorage‰∏≠ÁöÑbestScore:', localStorage.getItem('bestScore'));
            // Ê∏ÖÈô§localStorage‰∏≠ÁöÑÊï∞ÊçÆ
            localStorage.removeItem('bestScore');
            // ÈáçÁΩÆbestScoreÂØπË±°
            bestScore = {};
            // ÂàùÂßãÂåñÂºÄÂßãÊó∂Èó¥
            startTime = Date.now();
            // ÂÅúÊ≠¢ËÆ°Êó∂Âô®
            clearInterval(timerInterval);
            // Ê®°ÊãüÊ∏∏ÊàèÂÆåÊàê
            gameComplete();
        }

        function initializeCards() {
            const gameContainer = document.querySelector('.game-container');
            const allPairs = [...wordPairs];
            
            // ÂàùÂßãÂåñÂç°ÁâáÊï∞ÁªÑ
            cards = [];
            allPairs.forEach(pair => {
                cards.push({ text: pair.english, type: 'english', matched: false });
                cards.push({ text: pair.chinese, type: 'chinese', matched: false });
            });
            
            // Ê¥óÁâå
            for (let i = cards.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [cards[i], cards[j]] = [cards[j], cards[i]];
            }
            
            // ÂàõÂª∫Âç°ÁâáÂÖÉÁ¥†
            gameContainer.innerHTML = '';
            cards.forEach((card, index) => {
                const cardElement = document.createElement('div');
                cardElement.className = `card ${card.type}`;
                cardElement.textContent = getCardText(card, index);
                cardElement.dataset.index = index;
                cardElement.onclick = () => selectCard(index);
                gameContainer.appendChild(cardElement);
            });

            // Âú®Âõ∞ÈöæÊ®°Âºè‰∏ãÂàùÂßãÊòæÁ§∫3‰∏™‰∏≠ÊñáÂç°Áâá
            if (currentDifficulty === 'hard') {
                revealInitialCards();
            }
        }

        // ÂàùÂßãÂåñÊ∏∏Êàè
        initGame();
    </script>
</body>
</html>
